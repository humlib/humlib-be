# humlib-be
Backend for HumLib - The Human Library in Computer Science

## Development workflow
We use [GitHub flow](https://githubflow.github.io/) as git branching strategy. It is based on the 6 principles below.

- Anything in the master branch is deployable
- To work on something new, create a descriptively named branch off of master (ie: new-oauth2-scopes)
- Commit to that branch locally and regularly push your work to the same named branch on the server
- When you need feedback or help, or you think the branch is ready for merging, open a pull request
- After someone else has reviewed and signed off on the feature, you can merge it into master
- Once it is merged and pushed to 'master', you can and should deploy immediately

For commit messages, we use [GitMoji](https://gitmoji.dev/). There is a handy IntelliJ plugin to help you choose the right emoji.
Other than that, a commit message should follow the pattern `:emoji: Short description (#:issue number:)`.

## Docker
### Prerequisites
- docker desktop
- at least 6GB available memory
- each docker container uses 1GB memory per default. Change this behaviour per environment via
  - [DOCKER_MEM_LIMIT_ELASTICSTACK](docker/.env.local 'DOCKER_MEM_LIMIT_ELASTICSTACK')
  - [DOCKER_MEM_LIMIT_KEYCLOAK](docker/.env.local 'DOCKER_MEM_LIMIT_KEYCLOAK')

## Elasticstack
version: [8.0.0](https://www.elastic.co/guide/en/elastic-stack-get-started/8.0/get-started-stack-docker.html#run-docker-secure "documentation")

### Setup
- open a terminal
- navigate to the directory `humlib-be/docker`
- copy `humlib.profiles` to `humlib.profiles.overrides` and set the absolute path to this repository
- execute `source humlib.profiles.overrides`

### Start and stop commands
- initialize and start the elasticstack via `humlib-be-elasticstack-start`
- if you only want to run elasticsearch, use the command `humlib-be-elasticstack-start-min`
- stop the docker setup with the command `humlib-be-elasticstack-stop` or stop and delete all volumes via `humlib-be-elasticstack-delete`

### Usage
- copy the autogenerated elasticstack certificate to your keychain [docker/elasticstack/volumes/certs/ca/ca.crt](docker/elasticstack/volumes/certs/ca/ca.crt 'docker/elasticstack/volumes/certs/ca/ca.crt')
- elasticsearch: [https://localhost:9200](https://localhost:9200 'https://localhost:9200')
- kibana: [http://localhost:5601](http://localhost:5601 'http://localhost:5601')
- logstash: listens for beats input on port 5044 ([localhost:5044](localhost:5044 'localhost:5044')) and reads `*.log`-files from the directory `humlib-be/logs`

### Built-in users
- superuser: elastic - password: [ELASTICSTACK_USER_ELASTIC_PASSWORD](docker/.env.local 'ELASTICSTACK_USER_ELASTIC_PASSWORD')
- user: kibana_systems - password: [ELASTICSTACK_USER_KIBANA_SYSTEM_PASSWORD](docker/.env.local 'ELASTICSTACK_USER_KIBANA_SYSTEM_PASSWORD')

## Keycloak
### Start and stop commands
- initialize and start the elasticstack via `humlib-be-keycloak-start`
- stop the docker setup with the command `humlib-be-keycloak-stop` or stop and delete all volumes via `humlib-be-keycloak-delete`

### Built-in users
- admin: [KEYCLOAK_ADMIN_USERNAME](docker/.env.local 'KEYCLOAK_ADMIN_USERNAME') - password: [KEYCLOAK_ADMIN_PASSWORD](docker/.env.local 'KEYCLOAK_ADMIN_PASSWORD')
